- id: watching_tv
  alias: Watching TV
  trigger:
  - platform: state
    entity_id:
    - sensor.living_room_audio_input_format
    from: No input
  action:
  - service: media_player.media_pause
    entity_id: media_player.upstairs
  mode: single
- id: leaving_home
  alias: Leaving home
  description: Turn down the thermostat and turn off the lights when everyone leaves
    and stays away for 5 minutes.
  trigger:
  - platform: state
    entity_id: input_boolean.house_occupied
    from: 'on'
    for: 00:05:00
    to: 'off'
  action:
  - service: light.turn_off
    target:
      entity_id: light.everywhere
    data: {}
  - service: media_player.media_pause
    data: {}
    target:
      entity_id:
      - media_player.upstairs
      - media_player.living_room_arc
  - service: script.thermostat_away
    data: {}
  mode: single
- id: returning_home
  alias: Returning home
  description: Turn up the thermostat and turn on the lights when someone comes home
  trigger:
  - platform: state
    entity_id: input_boolean.house_occupied
    from: 'off'
    to: 'on'
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.vacation_mode
    data: {}
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.automatic_charging
    enabled: false
  - condition: time
    after: input_datetime.morning_time
    before: input_datetime.night_time
  - service: script.home_music
    data: {}
  mode: single
- id: store_hourly_utility_usage
  alias: Store hourly utility usage
  trigger:
  - platform: time_pattern
    minutes: '59'
    seconds: '59'
  action:
  - service: notify.utilityhourly
    data_template:
      message: ',{{states.sensor.energy_consumption_tarif_1.state}},{{states.sensor.energy_consumption_tarif_2.state}},{{states.sensor.energy_production_tarif_1.state}},{{states.sensor.energy_production_tarif_2.state}},{{states.sensor.gas_consumption.state}},{{states.sensor.current_electricity_price_all_in.state}},{{states.sensor.current_gas_price_all_in.state}},{{states.sensor.current_electricity_market_price.state}},{{states.sensor.current_electricity_sourcing_markup.state}},{{states.sensor.current_electricity_tax_only.state}}'
  initial_state: 'true'
  mode: single
- id: store_daily_utility_usage
  alias: Store daily utility usage
  trigger:
  - platform: time
    at: '23:59:55'
  action:
  - service: notify.utilitydaily
    data_template:
      message: ',{{states.sensor.energy_daily_low_meter.state}},{{states.sensor.energy_daily_high_meter.state}},{{states.sensor.energy_production_daily_low_meter.state}},{{states.sensor.energy_production_daily_high_meter.state}},{{(states.sensor.solaredge_energy_today.state
        | float)/1000}},{{states.sensor.gas_daily_meter.state}},{{states.sensor.energy_consumption_tarif_1.state}},{{states.sensor.energy_consumption_tarif_2.state}},{{states.sensor.energy_production_tarif_1.state}},{{states.sensor.energy_production_tarif_2.state}},{{states.sensor.gas_consumption.state}}'
  initial_state: 'true'
  mode: single
- id: store_monthly_utility_usage
  alias: Store monthly utility usage
  trigger:
  - platform: time
    at: input_datetime.end_of_month
  condition: []
  action:
  - service: notify.utilitymonthly
    data_template:
      message: ',{{states.sensor.energy_monthly_low_meter.state}},{{states.sensor.energy_monthly_high_meter.state}},{{states.sensor.energy_production_monthly_low_meter.state}},{{states.sensor.energy_production_monthly_high_meter.state}},{{(states.sensor.solar_monthly_meter.state
        | float)/1000}},{{states.sensor.gas_monthly_meter.state}},{{states.sensor.energy_consumption_tarif_1.state}},{{states.sensor.energy_consumption_tarif_2.state}},{{states.sensor.energy_production_tarif_1.state}},{{states.sensor.energy_production_tarif_2.state}},{{states.sensor.gas_consumption.state}}'
  initial_state: 'true'
  mode: single
- id: sonos_off_at_night
  alias: downstairs off at night
  trigger:
  - platform: state
    entity_id: light.downstairs
    from: 'on'
    to: 'off'
    for: 00:05:00
  - platform: time
    at: input_datetime.night_time
  condition:
  - condition: time
    after: input_datetime.evening_time
    before: 05:00
  - condition: state
    entity_id: light.downstairs
    state: 'off'
  action:
  - service: media_player.media_pause
    data: {}
    target:
      entity_id:
      - media_player.upstairs
      - media_player.living_room_arc
  mode: single
- id: going_to_bed
  alias: Going to bed
  description: Turn off the thermostat and sonos after all the lights are turned off
    at night
  trigger:
  - platform: state
    entity_id: light.inside
    from: 'on'
    to: 'off'
    for: 00:05:00
  - platform: time
    at: input_datetime.night_time
  condition:
  - condition: time
    after: input_datetime.night_time
  - condition: state
    entity_id: light.inside
    state: 'off'
  - condition: state
    entity_id: group.awesome_people
    state: home
  - condition: state
    entity_id: input_boolean.night_time
    state: 'off'
  action:
  - service: script.thermostat_sleep
    data: {}
    enabled: false
  - service: media_player.media_pause
    data: {}
    target:
      entity_id:
      - media_player.upstairs
      - media_player.living_room_arc
  - service: light.turn_off
    target:
      entity_id:
      - light.inside
      - light.outside
    data: {}
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.night_time
    data: {}
  mode: single
- id: good_morning
  alias: Good Morning
  description: Triggers when first activity is detected downstairs
  trigger:
  - platform: state
    entity_id:
    - group.living_room_motion
    from: 'off'
    to: 'on'
  - type: occupied
    platform: device
    device_id: 71d01d5b98272a2072492782adc87ec9
    entity_id: binary_sensor.motion_f_occupancy
    domain: binary_sensor
  condition:
  - condition: and
    conditions:
    - condition: time
      after: input_datetime.morning_time
    - condition: state
      entity_id: input_boolean.woken_up
      state: 'off'
  action:
  - service: script.wake_up
    data: {}
  mode: single
- id: reset_states
  alias: Reset states
  description: Reset states for daily events
  trigger:
  - platform: time
    at: 06:00:00
  condition: []
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.woken_up
  mode: single
- id: night_time_toggle
  alias: Turn off night mode
  description: Toggle the time_night input boolean value
  trigger:
  - type: motion
    platform: device
    device_id: 71d01d5b98272a2072492782adc87ec9
    entity_id: binary_sensor.motion_f_activity
    domain: binary_sensor
  condition:
  - condition: time
    after: input_datetime.morning_time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    - sun
    before: input_datetime.evening_time
  - condition: state
    entity_id: input_boolean.night_time
    state: 'on'
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.night_time
    data: {}
  mode: single
- id: door_bell_pressed
  alias: doorbell
  description: ''
  trigger:
  - type: powered
    platform: device
    device_id: 5bfd9f27f34c77a83fd342bf8f93e7cc
    entity_id: binary_sensor.shelly1_e8db84d3500b_input
    domain: binary_sensor
  action:
  - service: script.doorbell
    data: {}
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  mode: single
- id: night_mode_on
  alias: turn on night mode
  description: ''
  trigger:
  - platform: state
    entity_id: light.everywhere
    to: 'off'
    for: 00:05:00
    from: 'on'
  - platform: time
    at: input_datetime.deep_night_time
  condition:
  - condition: time
    after: input_datetime.night_time
    before: input_datetime.morning_time
  - condition: state
    entity_id: light.everywhere
    state: 'off'
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.night_time
  - service: script.determine_last_day_of_month
  mode: single
- id: toggle_sleep_mode
  alias: Toggle sleep mode
  description: Toggle sleep mode for adaptive lights
  trigger:
  - platform: state
    entity_id: input_boolean.night_time
  - platform: homeassistant
    event: start
  action:
  - service: switch.turn_{{ sleep_mode }}
    entity_id:
    - switch.adaptive_lighting_sleep_mode_bedroom
    - switch.adaptive_lighting_sleep_mode_downstairs
    - switch.adaptive_lighting_sleep_mode_hallway_upstairs
    - switch.adaptive_lighting_sleep_mode_hallway_downstairs
    - switch.adaptive_lighting_sleep_mode_office
  variables:
    sleep_mode: '{{ states(''input_boolean.night_time'') }}'
  mode: single
- id: toggle_home_occupied
  alias: Toggle home occupied
  description: Set the home occupied boolean
  trigger:
  - platform: state
    entity_id: group.awesome_people
  - platform: homeassistant
    event: start
  condition:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: state
        entity_id: group.awesome_people
        state: home
      - condition: state
        entity_id: input_boolean.house_occupied
        state: 'off'
    - condition: and
      conditions:
      - condition: state
        entity_id: group.awesome_people
        state: not_home
      - condition: state
        entity_id: input_boolean.house_occupied
        state: 'on'
  action:
  - service: input_boolean.turn_{% if is_state('group.awesome_people', 'home') -%}on{%-
      else -%}off{%- endif %}
    entity_id: input_boolean.house_occupied
- id: toggle_climate_mode
  alias: Toggle climate mode
  trigger:
  - platform: state
    entity_id: input_select.climate_mode
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.climate_mode
        state: 'off'
      sequence:
      - service: climate.turn_off
        target:
          entity_id:
          - climate.living_room
          - climate.bedroom
          - climate.bathroom
          - climate.hallway
          - climate.office
        data: {}
    default: []
  mode: single
- id: '1623011723106'
  alias: Turn outside lights off when downstairs lights are turned off
  description: ''
  trigger:
  - platform: state
    entity_id: light.downstairs
    from: 'on'
    to: 'off'
  condition: []
  action:
  - service: light.turn_off
    target:
      entity_id:
      - light.outside
    data: {}
  mode: single
- id: '1625663312335'
  alias: Wake up lights bedroom
  description: ''
  trigger:
  - platform: time
    at: input_datetime.alarm_time
  condition:
  - condition: state
    entity_id: group.awesome_people
    state: home
  action:
  - service: switch.turn_off
    target:
      entity_id: switch.adaptive_lighting_bedroom
    data: {}
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.woken_up
    data: {}
  - service: hue.hue_activate_scene
    data:
      group_name: Bedroom
      scene_name: Frosty dawn
      transition: 300
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.night_time
    data: {}
  - service: input_boolean.turn_on
    target:
      entity_id:
      - input_boolean.living_room_automatic_lights
      - input_boolean.living_room_occupied_recently
      - input_boolean.upstairs_occupied_recently
    data: {}
  mode: single
- id: '1626004480351'
  alias: Tradfri remote
  description: ''
  use_blueprint:
    path: cascer1/zha_ikea_tradfri_5button_remote_double.yaml
    input:
      remote: 1644a0a0c1b7e73775bf31d020d05a45
      dimup_long: []
      dimdown_long: []
      dimdown_short:
      - service: light.toggle
        target:
          entity_id: light.living_room
        data: {}
      dimdown_short_double:
      - service: light.turn_on
        target:
          entity_id: light.living_room
        data:
          flash: short
      dimup_short_double:
      - service: light.turn_on
        target:
          entity_id:
          - light.upstairs
        data:
          flash: short
      power_short:
      - service: media_player.media_play_pause
        data: {}
        target:
          entity_id: media_player.living_room_arc
      colorup_short:
      - service: light.toggle
        data: {}
        target:
          area_id: garden
      dimup_short:
      - service: input_boolean.toggle
        data: {}
        target:
          entity_id: input_boolean.night_time
      power_short_double:
      - service: script.home_music
        data: {}
      colordown_long: []
      colordown_short:
      - service: input_boolean.toggle
        data: {}
        target:
          entity_id: input_boolean.living_room_automatic_lights
- id: '1626167291086'
  alias: Next alarm time changed
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.bert_phone_next_alarm
  - platform: state
    entity_id: sensor.cas_phone_next_alarm
  - platform: state
    entity_id: person.cas_eliens
    from: home
  - platform: state
    entity_id: person.bert
    from: home
  - platform: state
    entity_id: person.cas_eliens
    to: home
  - platform: state
    entity_id: person.bert
    to: home
  condition: []
  action:
  - service: script.determine_alarm_light_fade_time
  mode: single
- id: '1626362518806'
  alias: motion while away
  description: ''
  trigger:
  - platform: state
    from: 'off'
    to: 'on'
    entity_id: binary_sensor.motion_a_activity
    id: a
  - platform: state
    entity_id: binary_sensor.motion_c_activity
    from: 'off'
    to: 'on'
    id: c
  - platform: state
    entity_id: binary_sensor.motion_d_activity
    from: 'off'
    to: 'on'
    id: d
  - platform: state
    entity_id: binary_sensor.motion_e_activity
    to: 'on'
    from: 'off'
    id: e
  - platform: state
    entity_id: binary_sensor.motion_f_activity
    from: 'off'
    to: 'on'
    id: f
  - platform: state
    entity_id: binary_sensor.motion_b_activity
    id: b
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: group.awesome_people
    state: not_home
  action:
  - service: notify.mobile_app_cas_phone
    data:
      message: motion detected while nobody was home
  - delay:
      hours: 0
      minutes: 15
      seconds: 0
      milliseconds: 0
  mode: single
- id: '1626441573303'
  alias: motion lights scullery
  description: ''
  use_blueprint:
    path: cascer1/motion_light_illuminance_manual.yaml
    input:
      motion_entity: binary_sensor.motion_d_activity
      light_sensor: sensor.motion_d_illuminance
      no_motion_wait: 90
      automatic_control_boolean: input_boolean.scullery_automatic_lights
      light_level: 200
      light_target:
        entity_id: light.scullery
- id: '1627379539423'
  alias: motion lights office
  description: ''
  use_blueprint:
    path: cascer1/motion_light_illuminance_manual.yaml
    input:
      motion_entity: binary_sensor.motion_c_activity
      light_sensor: sensor.motion_c_illuminance
      light_target:
        entity_id: light.office_ceiling
      light_level: 200
      no_motion_wait: 1800
      automatic_control_boolean: input_boolean.office_automatic_lights
- id: '1627391476634'
  alias: Reset living automatic control
  description: ''
  use_blueprint:
    path: cascer1/reset_automatic_control.yaml
    input:
      motion_sensor: group.living_room_motion
      automatic_control_boolean: input_boolean.living_room_automatic_lights
- id: '1627391516741'
  alias: Reset office automatic control
  description: ''
  use_blueprint:
    path: cascer1/reset_automatic_control.yaml
    input:
      motion_sensor: binary_sensor.motion_c_activity
      automatic_control_boolean: input_boolean.office_automatic_lights
- id: '1627391800496'
  alias: Reset scullery automatic control
  description: ''
  use_blueprint:
    path: cascer1/reset_automatic_control.yaml
    input:
      motion_sensor: binary_sensor.motion_d_activity
      automatic_control_boolean: input_boolean.scullery_automatic_lights
- id: '1627455358038'
  alias: Sonos off when living room is empty
  description: ''
  trigger:
  - platform: state
    entity_id: group.living_room_motion
    to: 'off'
    for: 02:00:00
  condition: []
  action:
  - service: media_player.media_pause
    target:
      entity_id:
      - media_player.living_room_arc
    data: {}
  mode: single
- id: '1628594764783'
  alias: Notify motion scullery
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.motion_d_activity
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: notify.mobile_app_cas_phone
    data:
      title: Motion in scullery
      message: motion in scullery
  mode: single
- id: '1629107975223'
  alias: Toggle heating system
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.heating_required
  - platform: homeassistant
    event: start
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.heating_required
        state: 'on'
      sequence:
      - service: script.boiler_heating
        data: {}
    default:
    - service: switch.turn_off
      target:
        entity_id: switch.shelly1_boiler
      data: {}
    - delay:
        hours: 0
        minutes: 3
        seconds: 0
        milliseconds: 0
    - type: turn_off
      device_id: adca78ce5ccc0f695957716cd0ef5726
      entity_id: switch.tradfri_plug_d
      domain: switch
  mode: restart
- id: '1629270475151'
  alias: Notify motion downstairs
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.motion_a_activity
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: binary_sensor.motion_b_activity
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: notify.mobile_app_cas_phone
    data:
      title: motion downstairs
      message: motion downstairs
  mode: single
- id: '1633324619410'
  alias: toggle outside lights
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sun.sun
    attribute: elevation
    below: -1
  - platform: state
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 0
    entity_id:
    - light.living_room
  - platform: state
    entity_id:
    - input_boolean.night_time
    from: 'on'
    to: 'off'
  condition:
  - condition: state
    entity_id: light.living_room
    state: 'on'
  - condition: numeric_state
    entity_id: sun.sun
    attribute: elevation
    below: -1
  - condition: state
    entity_id: input_boolean.night_time
    state: 'off'
  action:
  - service: light.turn_on
    data:
      transition: 15
      brightness: 205
    target:
      entity_id:
      - light.garden_table
      - light.garden
  mode: single
- id: '1633325316903'
  alias: sun rising
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sun.sun
    attribute: elevation
    above: 0
  condition: []
  action:
  - service: light.turn_off
    target:
      entity_id:
      - light.garden
      - light.garden_table
    data: {}
  mode: single
- id: '1634633811557'
  alias: motion lights living room
  description: ''
  use_blueprint:
    path: cascer1/motion_light_scenes.yaml
    input:
      motion_entity: group.living_room_motion
      no_motion_wait: 1800
      automation_blocker: input_boolean.living_room_automatic_lights
      no_motion_blocker: input_boolean.living_room_automatic_lights
      automation_blocker_boolean: true
      no_motion_blocker_boolean: true
      light_sensor: sensor.living_room_illuminance
      scene_evening: scene.living_room_evening
      scene_night: scene.living_room_night
      elevation_scene_morning: 3
      elevation_scene_evening: 1
      night_state_boolean: input_boolean.night_time
      light_level: 200
      scene_morning: scene.living_room_morning
      scene_day: scene.living_room_day
      light_target:
        entity_id: light.living_room
- id: '1634634953446'
  alias: motion lights downstairs hallway
  description: ''
  use_blueprint:
    path: cascer1/motion_light_scenes.yaml
    input:
      motion_entity: binary_sensor.motion_f_activity
      light_target:
        entity_id:
        - light.downstairs_hallway
      no_motion_wait: 60
      automation_blocker: input_boolean.hallway_downstairs_automatic_lights
      no_motion_blocker: input_boolean.hallway_downstairs_automatic_lights
      automation_blocker_boolean: true
      no_motion_blocker_boolean: true
      light_sensor: sensor.motion_f_illuminance
      light_level: 70
      scene_day: scene.downstairs_hallway_day
      scene_evening: scene.downstairs_hallway_evening
      scene_night: scene.downstairs_hallway_night
      elevation_scene_morning: 3
      elevation_scene_evening: 3
      night_state_boolean: input_boolean.night_time
      scene_morning: scene.downstairs_hallway_morning
- id: '1634635044994'
  alias: motion lights upstairs hallway
  description: ''
  use_blueprint:
    path: cascer1/motion_light_scenes.yaml
    input:
      motion_entity: binary_sensor.motion_e_activity
      light_target:
        entity_id:
        - light.upstairs_hallway
      no_motion_wait: 60
      automation_blocker: input_boolean.hallway_upstairs_automatic_lights
      no_motion_blocker: input_boolean.hallway_upstairs_automatic_lights
      automation_blocker_boolean: true
      no_motion_blocker_boolean: true
      light_sensor: sensor.motion_e_illuminance
      light_level: 50
      scene_morning: scene.upstairs_hallway_morning
      scene_day: scene.upstairs_hallway_day
      scene_evening: scene.upstairs_hallway_evening
      scene_night: scene.upstairs_hallway_night
      elevation_scene_morning: 5
      elevation_scene_evening: 5
      night_state_boolean: input_boolean.night_time
- id: '1639472744919'
  alias: Turn on vacation mode
  description: ''
  trigger:
  - platform: state
    entity_id: input_boolean.house_occupied
    to: 'off'
    for:
      hours: 24
      minutes: 0
      seconds: 0
    from: 'on'
  condition: []
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.vacation_mode
  mode: single
- id: '1639598241889'
  alias: christmas lights
  description: ''
  trigger:
  - platform: state
    entity_id: light.living_room
    from: 'on'
    to: 'off'
    id: 'off'
  - platform: state
    entity_id:
    - group.living_room_motion
    - light.living_room
    from: 'off'
    to: 'on'
    id: 'on'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - type: turn_on
        device_id: 5018b989986a146d43d4f973bd4d0355
        entity_id: switch.shelly_plug_2
        domain: switch
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - type: turn_off
        device_id: 5018b989986a146d43d4f973bd4d0355
        entity_id: switch.shelly_plug_2
        domain: switch
    default: []
  mode: single
- id: '1644910207975'
  alias: Toggle office recent occupancy
  description: ''
  trigger:
  - type: occupied
    platform: device
    device_id: cf6f9edd3cf8df988c8fa48816bf2759
    entity_id: binary_sensor.motion_c_occupancy
    domain: binary_sensor
    id: occupied
  - type: no_motion
    platform: device
    device_id: cf6f9edd3cf8df988c8fa48816bf2759
    entity_id: binary_sensor.motion_c_activity
    domain: binary_sensor
    for:
      hours: 0
      minutes: 45
      seconds: 0
    id: empty
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: occupied
      sequence:
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.office_occupied_recently
    - conditions:
      - condition: trigger
        id: empty
      sequence:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.office_occupied_recently
    default: []
  mode: single
- id: '1646206381505'
  alias: Toggle upstairs recent occupancy
  description: ''
  trigger:
  - platform: state
    entity_id: group.upstairs_motion
    id: occupied
    to: 'on'
  - platform: state
    entity_id: group.upstairs_motion
    id: empty
    to: 'off'
    for:
      hours: 1
      minutes: 0
      seconds: 0
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: occupied
      sequence:
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.upstairs_occupied_recently
    - conditions:
      - condition: trigger
        id: empty
      sequence:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.upstairs_occupied_recently
    default: []
  mode: single
- id: '1646811560297'
  alias: Google Home Dashboard
  description: Turn on the dashboard view on google home
  trigger:
  - platform: state
    entity_id: input_boolean.dashboard
    from: 'off'
    to: 'on'
    id: 'on'
  - platform: device
    device_id: d5d8714268a2ce7dd362b921e9702129
    domain: media_player
    entity_id: media_player.living_room_display
    type: turned_off
    id: done
  - platform: state
    entity_id: input_boolean.dashboard
    from: 'on'
    to: 'off'
    id: 'off'
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: 'on'
      sequence:
      - delay:
          hours: 0
          minutes: 0
          seconds: 10
          milliseconds: 0
      - service: media_player.play_media
        target:
          entity_id: media_player.living_room_display
        data:
          media_content_id: lovelace-control
          media_content_type: lovelace
        metadata:
          title: lovelace-control
          thumbnail: https://brands.home-assistant.io/_/lovelace/logo.png
          media_class: app
          children_media_class:
          navigateIds:
          - {}
          - media_content_type: lovelace
            media_content_id: ''
    - conditions:
      - condition: trigger
        id: done
      sequence:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.dashboard
    - conditions:
      - condition: trigger
        id: 'off'
      sequence:
      - service: media_player.media_stop
        data: {}
        target:
          entity_id: media_player.living_room_display
    default: []
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  mode: single
- id: '1652769201966'
  alias: Reset upstairs hallway automatic control
  description: ''
  use_blueprint:
    path: cascer1/reset_automatic_control.yaml
    input:
      motion_sensor: binary_sensor.motion_e_activity
      automatic_control_boolean: input_boolean.hallway_upstairs_automatic_lights
- id: '1653232945525'
  alias: Bert Remote
  description: ''
  use_blueprint:
    path: cascer1/zha_ikea_tradfri_on_off.yaml
    input:
      remote: 230393437d431d2523e53250017ba426
      on_short:
      - type: toggle
        device_id: fc2a86e47b35a06a62f296f0ddb199a5
        entity_id: light.office_ceiling
        domain: light
      off_short:
      - service: input_boolean.toggle
        data: {}
        target:
          entity_id: input_boolean.office_automatic_lights
      on_double:
      - service: light.turn_on
        data:
          flash: short
        target:
          entity_id:
          - light.inside
          - light.scullery
          - light.garden_table
      on_long:
      - type: toggle
        device_id: adca78ce5ccc0f695957716cd0ef5726
        entity_id: switch.tradfri_plug_d
        domain: switch
      off_long:
      - type: turn_off
        device_id: adca78ce5ccc0f695957716cd0ef5726
        entity_id: switch.tradfri_plug_d
        domain: switch
- id: '1653233230583'
  alias: Symfonisk remote
  description: ''
  use_blueprint:
    path: cascer1/zha_ikea_symfonisk_controller.yaml
    input:
      remote: a382be411096df845f8b3d385ede411d
      press:
      - service: media_player.media_play_pause
        data: {}
        target:
          entity_id:
          - media_player.living_room_arc
      clockwise:
      - condition: device
        device_id: 63f54d7f3098a47f14a5a25554006249
        domain: media_player
        entity_id: media_player.living_room_arc
        type: is_playing
      - repeat:
          count: '20'
          sequence:
          - service: media_player.volume_up
            data: {}
            target:
              entity_id: media_player.living_room_arc
          - service: media_player.volume_up
            data: {}
            target:
              entity_id: media_player.upstairs
          - delay:
              hours: 0
              minutes: 0
              seconds: 0
              milliseconds: 250
      counter_clockwise:
      - condition: device
        device_id: 63f54d7f3098a47f14a5a25554006249
        domain: media_player
        entity_id: media_player.living_room_arc
        type: is_playing
      - repeat:
          count: '20'
          sequence:
          - service: media_player.volume_down
            data: {}
            target:
              entity_id: media_player.living_room_arc
          - service: media_player.volume_down
            data: {}
            target:
              entity_id: media_player.upstairs
          - delay:
              hours: 0
              minutes: 0
              seconds: 0
              milliseconds: 250
- id: '1655908039977'
  alias: Turn on AC if temperature exceeds 30
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: climate.tstat_8d728f
    above: '30'
    attribute: current_temperature
  - platform: numeric_state
    entity_id: climate.office
    attribute: current_temperature
    above: '30'
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: RUN_AUTOMATIC_COOLING
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: group.awesome_people
      state: home
  action:
  - service: script.turn_on
    data: {}
    target:
      entity_id: script.automatic_cooling
  mode: single
- id: '1659441591677'
  alias: Stop automatic cooling
  description: ''
  trigger:
  - platform: event
    event_type: mobile_app_notification_action
    event_data:
      action: STOP_AUTOMATIC_COOLING
  condition: []
  action:
  - service: script.turn_off
    data: {}
    target:
      entity_id: script.automatic_cooling
  - service: climate.turn_off
    data: {}
    target:
      entity_id:
      - climate.bedroom
      - climate.living_room
  - service: notify.mobile_app_cas_phone
    data:
      message: Automatic cooling cancelled
      title: Inside temperature high
      data:
        tag: automatic-cooling
        channel: Climate
        sticky: 'false'
        persistent: 'false'
        visibility: public
        color: blue
        clickAction: /lovelace-home/climate
        actions:
        - action: RUN_AUTOMATIC_COOLING
          title: Cool 1 hour
  mode: single
- id: '1661168961006'
  alias: Adjust car charging speed
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_number.charge_speed
    id: calculated
  - platform: state
    entity_id:
    - input_number.max_car_charge
    - input_boolean.fully_charge_car
    - input_text.charge_full_time
    id: price
  - platform: time_pattern
    minutes: '30'
    id: time
  - platform: time_pattern
    minutes: '0'
    id: time_hour
  condition: []
  action:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: price
        - condition: trigger
          id: time
        - condition: trigger
          id: time_hour
      sequence:
      - service: script.determine_desired_charge_speed
        data: {}
    - conditions:
      - condition: trigger
        id: calculated
        alias: Calculation result changed
      sequence:
      - service: number.set_value
        data:
          value: '{{ states("input_number.charge_speed") | float(16) }}'
        target:
          entity_id: number.charger_maximum_current
    default: []
  mode: queued
- id: '1661427391496'
  alias: Turn AC off if energy price is high
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.cheap_electricity
    to: 'off'
    from: 'on'
  condition: []
  action:
  - device_id: f42d82a74108802a53625db1db202445
    domain: climate
    entity_id: climate.bedroom
    type: set_hvac_mode
    hvac_mode: 'off'
  - device_id: 6bb8155b8fbbb90e14e1bb876f56fff0
    domain: climate
    entity_id: climate.living_room
    type: set_hvac_mode
    hvac_mode: 'off'
  - service: automation.turn_off
    data: {}
    target:
      entity_id: automation.turn_ac_off_if_energy_price_is_high
  mode: single
- id: '1663255657742'
  alias: Disable full car charging on disconnect
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.charger_status_connector
    to: Available
  condition:
  - condition: state
    entity_id: input_boolean.fully_charge_car
    state: 'on'
  action:
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.fully_charge_car
  mode: single
- id: '1663590509763'
  alias: Heating office
  description: ''
  use_blueprint:
    path: cascer1/zone_heating.yaml
    input:
      climate_mode_sensor: input_select.climate_mode
      thermostat: climate.office
      zone_occupance_sensor: input_boolean.office_occupied_recently
      home_occupance_sensor: input_boolean.house_occupied
      vacation_mode_sensor: input_boolean.vacation_mode
      heating_schedule_sensor: schedule.heating_office
      occupied_temperature: input_number.temperature_office_occupied
      unoccupied_temperature: input_number.temperature_office_empty
      cold_temperature: input_number.temperature_office_cold
      away_temperature: input_number.temperature_office_away
      vacation_temperature: input_number.temperature_office_vacation
- id: '1663590736789'
  alias: Heating bathroom
  description: ''
  use_blueprint:
    path: cascer1/zone_heating.yaml
    input:
      climate_mode_sensor: input_select.climate_mode
      thermostat: climate.bathroom
      zone_occupance_sensor: input_boolean.upstairs_occupied_recently
      home_occupance_sensor: input_boolean.house_occupied
      vacation_mode_sensor: input_boolean.vacation_mode
      heating_schedule_sensor: schedule.heating_bathroom
      occupied_temperature: input_number.temperature_bathroom_occupied
      unoccupied_temperature: input_number.temperature_bathroom_empty
      cold_temperature: input_number.temperature_bathroom_cold
      away_temperature: input_number.temperature_bathroom_away
      vacation_temperature: input_number.temperature_bathroom_vacation
- id: '1663592394841'
  alias: Heating living room
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_number.temperature_living_away
    - input_number.temperature_living_cold
    - input_number.temperature_living_empty
    - input_number.temperature_living_occupied
    - input_number.temperature_living_vacation
    - input_boolean.vacation_mode
    - schedule.heating_living_room
    - input_boolean.house_occupied
    - input_select.climate_mode
    - input_boolean.living_room_occupied_recently
  condition: []
  action:
  - if:
    - condition: not
      conditions:
      - condition: state
        entity_id: input_select.climate_mode
        state: heat
    then:
    - stop: Stopped in not heating mode
    alias: Check heating mode
  - if:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'on'
    then:
    - if:
      - condition: state
        entity_id: schedule.heating_living_room
        state: 'on'
      then:
      - service: climate.turn_on
        data: {}
        target:
          entity_id: climate.living_room
      - delay:
          hours: 0
          minutes: 0
          seconds: 10
          milliseconds: 0
      - service: climate.set_temperature
        data:
          temperature: '{{ states(''input_number.temperature_living_vacation'') |
            float (16)}}'
          hvac_mode: heat
        target:
          entity_id: climate.living_room
      else:
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: climate.living_room
            state: 'off'
        then:
        - service: climate.turn_off
          data: {}
          target:
            entity_id:
            - climate.living_room
      enabled: false
    - stop: Stopped in vacation mode
    alias: Check vacation mode
  - if:
    - condition: state
      entity_id: input_boolean.house_occupied
      state: 'off'
    then:
    - if:
      - condition: state
        entity_id: schedule.heating_living_room
        state: 'on'
      then:
      - service: climate.set_temperature
        data:
          temperature: '{{ states(''input_number.temperature_living_away'') | float
            (16) }}'
          hvac_mode: heat
        target:
          entity_id: climate.living_room
        enabled: false
      - service: climate.turn_off
        data: {}
        target:
          entity_id: climate.living_room
      else:
      - service: climate.turn_off
        data: {}
        target:
          entity_id: climate.living_room
    - stop: Stopped in away mode
    alias: Check house occupied
  - if:
    - condition: state
      entity_id: schedule.heating_living_room
      state: 'off'
    then:
    - service: climate.set_temperature
      data:
        temperature: '{{ states(''input_number.temperature_living_cold'') | float
          (16) }}'
        hvac_mode: heat
      target:
        entity_id: climate.living_room
      enabled: false
    - service: climate.turn_off
      data: {}
      target:
        entity_id:
        - climate.living_room
    - stop: Stopped in cold mode
    alias: Check schedule is off
  - if:
    - condition: state
      entity_id: input_boolean.living_room_occupied_recently
      state: 'off'
    then:
    - service: climate.turn_on
      data: {}
      target:
        entity_id: climate.living_room
    - delay:
        hours: 0
        minutes: 0
        seconds: 3
        milliseconds: 0
    - service: climate.set_temperature
      data:
        temperature: '{{ states(''input_number.temperature_living_empty'') | float
          (16) }}'
        hvac_mode: heat
      target:
        entity_id: climate.living_room
    - stop: Stopped in empty mode
    alias: Check empty
  - service: climate.turn_on
    data: {}
    target:
      entity_id: climate.living_room
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - service: climate.set_temperature
    data:
      temperature: '{{ states(''input_number.temperature_living_occupied'') | float
        (16) }}'
      hvac_mode: heat
    target:
      entity_id: climate.living_room
  mode: queued
  max: 10
- id: '1663749109384'
  alias: Toggle living room recent occupancy
  description: ''
  trigger:
  - platform: state
    entity_id:
    - group.downstairs_motion
    id: occupied
    to: 'on'
  - platform: state
    entity_id:
    - group.downstairs_motion
    id: empty
    to: 'off'
    for:
      hours: 0
      minutes: 35
      seconds: 0
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: occupied
      sequence:
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.living_room_occupied_recently
    - conditions:
      - condition: trigger
        id: empty
      sequence:
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.living_room_occupied_recently
    default: []
  mode: single
- id: '1676291672530'
  alias: Automatically start car charging
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.charger_status_connector
    from: Available
    id: start
  - platform: state
    entity_id:
    - input_boolean.automatic_charging
    to: 'on'
    for:
      hours: 0
      minutes: 10
      seconds: 0
    id: timeout
  - platform: zone
    entity_id: person.cas_eliens
    zone: zone.home
    event: enter
    id: cas_home
  - platform: zone
    entity_id: person.bert
    zone: zone.home
    event: enter
    id: bert_home
  condition: []
  action:
  - if:
    - condition: trigger
      id: timeout
    then:
    - service: input_boolean.turn_off
      data: {}
      target:
        entity_id: input_boolean.automatic_charging
    alias: Timeout
  - if:
    - condition: and
      conditions:
      - condition: trigger
        id: start
      - condition: state
        entity_id: input_boolean.automatic_charging
        state: 'on'
    then:
    - delay:
        hours: 0
        minutes: 0
        seconds: 10
        milliseconds: 0
    - service: switch.turn_on
      data: {}
      target:
        entity_id: switch.charger_charge_control
    - service: input_boolean.turn_off
      data: {}
      target:
        entity_id: input_boolean.automatic_charging
    alias: Start charging
  - if:
    - condition: or
      conditions:
      - condition: trigger
        id: cas_home
      - condition: trigger
        id: bert_home
    then:
    - service: input_boolean.turn_on
      data: {}
      target:
        entity_id: input_boolean.automatic_charging
    alias: Coming home
  mode: queued
  max: 10
