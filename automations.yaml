- id: watching_tv
  alias: Watching TV
  trigger:
  - platform: state
    entity_id: media_player.plex_plex_for_android_tv_living_room_tv
    to: playing
  action:
  - service: media_player.media_pause
    entity_id: media_player.living_room_sonos
  mode: single
- id: thermostat_down_away
  alias: Thermostat low while away
  description: Keep the thermostat temperature down while away
  trigger:
  - platform: state
    entity_id: climate.tstat_8d728f
    attribute: temperature
  condition:
  - condition: state
    entity_id: input_boolean.house_occupied
    state: 'off'
  - condition: template
    value_template: '{{ (state_attr(''climate.tstat_8d728f'', ''temperature'')|float)
      > (states(''input_number.away_temperature'') | float) }}'
  action:
  - service: script.thermostat_away
  mode: single
- id: leaving_home
  alias: Leaving home
  description: Turn down the thermostat and turn off the lights when everyone leaves
    and stays away for 5 minutes.
  trigger:
  - platform: state
    entity_id: input_boolean.house_occupied
    from: 'on'
    for: 00:05:00
    to: 'off'
  action:
  - service: script.lights_not_home
  - service: script.thermostat_away
  - service: media_player.media_pause
    target:
      entity_id: media_player.living_room_sonos
  mode: single
- id: returning_home
  alias: Returning home
  description: Turn up the thermostat and turn on the lights when someone comes home
  trigger:
  - platform: state
    entity_id: input_boolean.house_occupied
    from: 'off'
    to: 'on'
  action:
  - service: script.thermostat_home
  - condition: time
    after: input_datetime.morning_time
    before: input_datetime.night_time
  - service: script.home_music
  mode: single
- id: sun_setting
  alias: Sun setting
  trigger:
  - platform: sun
    event: sunset
    offset: -00:30:00
  condition:
  - condition: state
    entity_id: light.everywhere
    state: 'off'
  action:
  - service: script.lights{% if is_state('input_boolean.house_occupied', 'off') %}_not{%
      endif %}_home
  mode: single
- id: lights_off_away
  alias: lights off when away
  description: Turn off the lights when nobody is home at night
  trigger:
  - platform: time
    at: input_datetime.night_time
  - platform: numeric_state
    entity_id: sun.sun
    attribute: elevation
    above: input_number.sun_elevation_dark
  condition:
  - condition: state
    entity_id: input_boolean.house_occupied
    state: 'off'
  action:
  - service: light.turn_off
    entity_id: light.everywhere
  mode: single
- id: store_daily_utility_usage
  alias: Store daily utility usage
  trigger:
  - platform: time
    at: '23:59:55'
  action:
  - service: notify.utilitydaily
    data_template:
      message: ',{{states.sensor.energy_daily_low_meter.state}},{{states.sensor.energy_daily_high_meter.state}},{{states.sensor.energy_production_daily_low_meter.state}},{{states.sensor.energy_production_daily_high_meter.state}},{{(states.sensor.solaredge_energy_today.state
        | float)/1000}},{{states.sensor.gas_daily_meter.state}},{{states.sensor.energy_consumption_tarif_1.state}},{{states.sensor.energy_consumption_tarif_2.state}},{{states.sensor.energy_production_tarif_1.state}},{{states.sensor.energy_production_tarif_2.state}},{{states.sensor.gas_consumption.state}}'
  initial_state: 'true'
  mode: single
- id: store_monthly_utility_usage
  alias: Store monthly utility usage
  trigger:
  - platform: time
    at: input_datetime.end_of_month
  condition: []
  action:
  - service: notify.utilitymonthly
    data_template:
      message: ',{{states.sensor.energy_monthly_low_meter.state}},{{states.sensor.energy_monthly_high_meter.state}},{{states.sensor.energy_production_monthly_low_meter.state}},{{states.sensor.energy_production_monthly_high_meter.state}},{{(states.sensor.solar_monthly_meter.state
        | float)/1000}},{{states.sensor.gas_monthly_meter.state}},{{states.sensor.energy_consumption_tarif_1.state}},{{states.sensor.energy_consumption_tarif_2.state}},{{states.sensor.energy_production_tarif_1.state}},{{states.sensor.energy_production_tarif_2.state}},{{states.sensor.gas_consumption.state}}'
  initial_state: 'true'
  mode: single
- id: sonos_off_at_night
  alias: downstairs off at night
  trigger:
  - platform: state
    entity_id: light.downstairs
    from: 'on'
    to: 'off'
    for: 00:05:00
  - platform: time
    at: input_datetime.night_time
  condition:
  - condition: time
    after: input_datetime.evening_time
    before: 05:00:00
  - condition: state
    entity_id: light.downstairs
    state: 'off'
  action:
  - service: media_player.media_pause
    entity_id: media_player.living_room_sonos
  - service: climate.turn_off
    target:
      entity_id: climate.living_room
  mode: single
- id: going_to_bed
  alias: Going to bed
  description: Turn off the thermostat and sonos after all the lights are turned off
    at night
  trigger:
  - platform: state
    entity_id: light.inside
    from: 'on'
    to: 'off'
    for: 00:05:00
  - platform: time
    at: input_datetime.night_time
  condition:
  - condition: time
    after: input_datetime.night_time
  - condition: state
    entity_id: light.inside
    state: 'off'
  - condition: state
    entity_id: group.awesome_people
    state: home
  - condition: state
    entity_id: input_boolean.night_time
    state: 'off'
  action:
  - service: script.thermostat_sleep
  - service: media_player.media_pause
    entity_id: media_player.living_room_sonos
  - service: light.turn_off
    target:
      entity_id:
      - light.inside
      - light.outside
  mode: single
- id: good_morning
  alias: Good Morning
  description: Triggers when first activity is detected downstairs
  trigger:
  - platform: state
    entity_id: light.downstairs
    from: 'off'
    to: 'on'
  condition:
  - condition: and
    conditions:
    - condition: time
      after: input_datetime.morning_time
    - condition: state
      entity_id: input_boolean.woken_up
      state: 'off'
  action:
  - service: script.wake_up
  mode: single
- id: reset_states
  alias: Reset states
  description: Reset states for daily events
  trigger:
  - platform: time
    at: 06:00:00
  condition: []
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.woken_up
  mode: single
- id: night_time_toggle
  alias: Turn off night mode
  description: Toggle the time_night input boolean value
  trigger:
  - platform: time
    at: input_datetime.morning_time
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.night_time
  mode: single
- id: door_bell_pressed
  alias: doorbell
  description: ''
  trigger:
  - type: powered
    platform: device
    device_id: 5bfd9f27f34c77a83fd342bf8f93e7cc
    entity_id: binary_sensor.shelly1_e8db84d3500b_input
    domain: binary_sensor
  action:
  - service: script.doorbell
    data: {}
  - delay: 1
  mode: single
- id: night_mode_on
  alias: turn on night mode
  description: ''
  trigger:
  - platform: state
    entity_id: light.everywhere
    to: 'off'
    for: 00:05:00
    from: 'on'
  - platform: time
    at: input_datetime.deep_night_time
  condition:
  - condition: time
    after: input_datetime.night_time
    before: input_datetime.morning_time
  - condition: state
    entity_id: light.everywhere
    state: 'off'
  action:
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.night_time
  mode: single
- id: toggle_sleep_mode
  alias: Toggle sleep mode
  description: Toggle sleep mode for adaptive lights
  trigger:
  - platform: state
    entity_id: input_boolean.night_time
  - platform: homeassistant
    event: start
  action:
  - service: switch.turn_{{ sleep_mode }}
    entity_id:
    - switch.adaptive_lighting_sleep_mode_bedroom
    - switch.adaptive_lighting_sleep_mode_downstairs
    - switch.adaptive_lighting_sleep_mode_hallway
  variables:
    sleep_mode: '{{ states(''input_boolean.night_time'') }}'
  mode: single
- id: toggle_home_occupied
  alias: Toggle home occupied
  description: Set the home occupied boolean
  trigger:
  - platform: state
    entity_id: group.awesome_people
  - platform: homeassistant
    event: start
  action:
  - service: input_boolean.turn_{% if is_state('group.awesome_people', 'home') -%}on{%-
      else -%}off{%- endif %}
    entity_id: input_boolean.house_occupied
- id: toggle_climate_mode
  alias: Toggle climate mode
  trigger:
  - platform: state
    entity_id: input_select.climate_mode
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_select.climate_mode
        state: 'off'
      sequence:
      - service: climate.turn_off
        target:
          entity_id:
          - climate.living_room
          - climate.bedroom
          - climate.bathroom
          - climate.hallway
          - climate.office
    default:
    - service: script.reload_climate_automations
  mode: single
- id: '1623011723106'
  alias: Turn outside lights off when downstairs lights are turned off
  description: ''
  trigger:
  - platform: state
    entity_id: light.downstairs
    from: 'on'
    to: 'off'
  condition:
  - condition: time
    after: input_datetime.evening_time
    before: input_datetime.morning_time
  action:
  - service: light.turn_off
    target:
      entity_id: light.outside
  mode: single
- id: '1625643897153'
  alias: Light switch bedroom bed
  description: ''
  use_blueprint:
    path: cascer1/zha_philips_dimmer_adaptive_lights.yaml
    input:
      remote: 0bb5a8e1cd2eaeae57aecfde809ff4a0
      brightness_step: 10
      adaptive_switch: switch.adaptive_lighting_bedroom
      lights:
        entity_id: light.bedroom_lights_zha_group_0x0003
- id: '1625646540727'
  alias: Light switch office
  description: ''
  use_blueprint:
    path: cascer1/zha_philips_dimmer_adaptive_lights_manual.yaml
    input:
      remote: 0c4da719bcb63f5906a981887107b46c
      brightness_step: 10
      adaptive_switch: switch.adaptive_lighting_office
      automatic_on_boolean: input_boolean.office_light_automatic_on
      automatic_off_boolean: input_boolean.office_light_automatic_off
      lights:
        entity_id: light.office_ceiling
- id: '1625655627109'
  alias: light switch side kitchen
  description: ''
  use_blueprint:
    path: cascer1/zha_philips_dimmer_adaptive_lights_manual.yaml
    input:
      remote: 725f1bc736179cea1cbacc1246b50efc
      lights:
        entity_id:
        - light.side_kitchen_lights_zha_group_0x0002
      brightness_step: 10
      adaptive_switch: switch.adaptive_lighting_side_kitchen
      automatic_on_boolean: input_boolean.side_kitchen_light_automatic_on
      automatic_off_boolean: input_boolean.side_kitchen_light_automatic_off
- id: '1625655673754'
  alias: light switch kitchen
  description: ''
  use_blueprint:
    path: cascer1/zha_philips_dimmer_adaptive_lights_manual.yaml
    input:
      remote: 2498812930e32477ec650a77852af040
      brightness_step: 10
      adaptive_switch: switch.adaptive_lighting_downstairs
      lights:
        entity_id: light.kitchen_lights_zha_group_0x0005
      automatic_on_boolean: input_boolean.living_room_light_automatic_on
      automatic_off_boolean: input_boolean.living_room_light_automatic_off
- id: '1625655734660'
  alias: light switch living room
  description: ''
  use_blueprint:
    path: cascer1/zha_philips_dimmer_adaptive_lights_manual.yaml
    input:
      remote: 61dafb48861c8abf564ec83f1ce11449
      brightness_step: 10
      adaptive_switch: switch.adaptive_lighting_downstairs
      automatic_off_boolean: input_boolean.living_room_light_automatic_off
      automatic_on_boolean: input_boolean.living_room_light_automatic_on
      lights:
        entity_id:
        - light.tv_zha_group_0x0009
        - light.kitchen_lights_zha_group_0x0005
        - light.dining_table_zha_group_0x0007
- id: '1625656128887'
  alias: light switch bedroom wall
  description: ''
  use_blueprint:
    path: cascer1/zha_philips_dimmer_adaptive_lights.yaml
    input:
      remote: 72a685de44cfc5e1847aeed00d4da9c8
      brightness_step: 10
      adaptive_switch: switch.adaptive_lighting_bedroom
      lights:
        entity_id: light.bedroom_lights_zha_group_0x0003
- id: '1625663312335'
  alias: Wake up lights bedroom
  description: ''
  trigger:
  - platform: time
    at: input_datetime.alarm_time
  condition:
  - condition: state
    entity_id: group.awesome_people
    state: home
  action:
  - service: switch.turn_off
    target:
      entity_id: switch.adaptive_lighting_bedroom
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.woken_up
  - service: scene.turn_on
    target:
      entity_id: scene.morning_lights
    data:
      transition: 300
  mode: single
- id: '1626004480351'
  alias: Tradfri remote
  description: ''
  use_blueprint:
    path: cascer1/zha_ikea_tradfri_5button_remote_double.yaml
    input:
      remote: 1644a0a0c1b7e73775bf31d020d05a45
      dimup_long: []
      dimdown_long: []
      dimdown_short:
      - service: light.toggle
        target:
          entity_id: light.downstairs_lights_zha_group_0x0004
      dimdown_short_double:
      - service: script.flash_light
        data:
          flash_mode: short
          light_entity:
            entity_id: light.downstairs_lights_zha_group_0x0004
          adaptive_light_entity:
            entity_id: switch.adaptive_lighting_downstairs
      dimup_short_double:
      - service: script.flash_light
        data:
          flash_mode: short
          light_entity:
            entity_id: light.office_ceiling
          adaptive_light_entity:
            entity_id: switch.adaptive_lighting_office
      power_short:
      - service: media_player.media_play_pause
        target:
          entity_id: media_player.living_room_sonos
- id: '1626167291086'
  alias: Next alarm time changed
  description: ''
  trigger:
  - platform: state
    entity_id: sensor.bert_phone_next_alarm
  - platform: state
    entity_id: sensor.cas_phone_next_alarm
  - platform: state
    entity_id: person.cas_eliens
    from: home
  - platform: state
    entity_id: person.bert
    from: home
  - platform: state
    entity_id: person.cas_eliens
    to: home
  - platform: state
    entity_id: person.bert
    to: home
  condition: []
  action:
  - service: script.determine_alarm_light_fade_time
  mode: single
- id: '1626347682611'
  alias: motion living room
  description: ''
  use_blueprint:
    path: cascer1/motion_light_illuminance_manual.yaml
    input:
      light_level: 200
      no_motion_wait: 1800
      light_sensor: sensor.living_room_illuminance
      motion_entity: group.living_room_motion
      power_on_boolean: input_boolean.living_room_light_automatic_on
      power_off_boolean: input_boolean.living_room_light_automatic_off
      light_target:
        entity_id:
        - light.tv_zha_group_0x0009
        - light.dining_table_zha_group_0x0007
- id: '1626362518806'
  alias: motion while away
  description: ''
  trigger:
  - platform: state
    from: 'off'
    to: 'on'
    entity_id: binary_sensor.motion_a_activity
  - platform: state
    entity_id: binary_sensor.motion_b_activity
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: binary_sensor.motion_c_activity
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: binary_sensor.motion_c_activity
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    entity_id: group.awesome_people
    state: not_home
  action:
  - service: notify.mobile_app_cas_phone
    data:
      message: motion detected while nobody was home
  mode: single
- id: '1626441573303'
  alias: Motion side kitchen
  description: ''
  use_blueprint:
    path: cascer1/motion_light_illuminance_manual.yaml
    input:
      motion_entity: binary_sensor.motion_d_activity
      light_sensor: sensor.motion_d_illuminance
      no_motion_wait: 90
      light_target:
        entity_id: light.side_kitchen_lights_zha_group_0x0002
      power_on_boolean: input_boolean.side_kitchen_light_automatic_on
      power_off_boolean: input_boolean.side_kitchen_light_automatic_off
      light_level: 300
- id: '1627379539423'
  alias: motion office
  description: ''
  use_blueprint:
    path: cascer1/motion_light_illuminance_manual.yaml
    input:
      motion_entity: binary_sensor.motion_c_activity
      light_sensor: sensor.motion_c_illuminance
      light_target:
        entity_id: light.office_ceiling
      light_level: 200
      no_motion_wait: 1800
      power_on_boolean: input_boolean.office_light_automatic_on
      power_off_boolean: input_boolean.office_light_automatic_off
- id: '1627391476634'
  alias: Reset living automatic control
  description: ''
  use_blueprint:
    path: cascer1/reset_automatic_control.yaml
    input:
      motion_sensor: group.living_room_motion
      automatic_on_boolean: input_boolean.living_room_light_automatic_on
      automatic_off_boolean: input_boolean.living_room_light_automatic_off
- id: '1627391516741'
  alias: Reset office automatic control
  description: ''
  use_blueprint:
    path: cascer1/reset_automatic_control.yaml
    input:
      motion_sensor: binary_sensor.motion_c_activity
      automatic_on_boolean: input_boolean.office_light_automatic_on
      automatic_off_boolean: input_boolean.office_light_automatic_off
- id: '1627391800496'
  alias: Reset side kitchen automatic control
  description: ''
  use_blueprint:
    path: cascer1/reset_automatic_control.yaml
    input:
      motion_sensor: binary_sensor.motion_d_activity
      automatic_on_boolean: input_boolean.side_kitchen_light_automatic_on
      automatic_off_boolean: input_boolean.side_kitchen_light_automatic_off
- id: '1627455358038'
  alias: Sonos off when living room is empty
  description: ''
  trigger:
  - platform: state
    entity_id: group.living_room_motion
    to: 'off'
    for: 02:00:00
  condition: []
  action:
  - service: media_player.media_pause
    target:
      entity_id: media_player.living_room_sonos
  mode: single
- id: '1628594764783'
  alias: Notify motion scullery
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.motion_d_activity
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: notify.mobile_app_cas_phone
    data:
      title: Motion in scullery
      message: motion in scullery
  mode: single
- id: '1628666368372'
  alias: Maximum temperature when away
  description: Ensure temperature range while nobody is home
  trigger:
  - platform: numeric_state
    entity_id: sensor.temp_b_temperature
    above: '35'
    for: 01:00:00
  - platform: numeric_state
    entity_id: sensor.temp_c_temperature
    above: '35'
    for: 01:00:00
  - platform: numeric_state
    entity_id: sensor.tstat_8d728f_current_temperature
    above: '35'
    for: 01:00:00
  condition:
  - condition: state
    entity_id: input_boolean.house_occupied
    state: 'off'
  action:
  - service: climate.turn_on
    target:
      entity_id:
      - climate.bedroom
      - climate.living_room
  - delay:
      hours: 0
      minutes: 0
      seconds: 10
      milliseconds: 0
  - service: climate.set_hvac_mode
    target:
      entity_id:
      - climate.living_room
      - climate.bedroom
    data:
      hvac_mode: cool
  - delay:
      hours: 0
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: climate.turn_off
    target:
      entity_id:
      - climate.bedroom
      - climate.living_room
  mode: single
- id: '1628782433508'
  alias: motion kitchen
  description: ''
  use_blueprint:
    path: cascer1/motion_light_illuminance_manual.yaml
    input:
      no_motion_wait: 1800
      power_on_boolean: input_boolean.living_room_light_automatic_on
      power_off_boolean: input_boolean.living_room_light_automatic_off
      motion_entity: binary_sensor.motion_a_activity
      light_target:
        entity_id: light.kitchen_lights_zha_group_0x0005
      light_sensor: sensor.motion_a_illuminance
      light_level: 400
- id: '1629107975223'
  alias: Toggle heating system
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.heating_required
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.heating_required
        state: 'on'
      sequence:
      - service: climate.set_temperature
        target:
          entity_id: climate.tstat_8d728f
        data:
          temperature: 25
          hvac_mode: heat
    default:
    - service: climate.turn_off
      target:
        entity_id: climate.tstat_8d728f
  mode: single
- id: '1629270475151'
  alias: Notify motion downstairs
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.motion_a_activity
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: binary_sensor.motion_b_activity
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: notify.mobile_app_cas_phone
    data:
      title: motion downstairs
      message: motion downstairs
  mode: single
- id: '1629657109466'
  alias: Motion hallway upstairs
  description: ''
  use_blueprint:
    path: cascer1/motion_light_sleep_illuminance.yaml
    input:
      motion_entity: binary_sensor.motion_e_activity
      light_target:
        entity_id: light.hallway_upstairs_zha_group_0x000c
      sleep_light_target:
        entity_id:
        - light.upstairs_hallway_ceiling
        - light.upstairs_hallway_spot_stairs
      no_motion_wait: 30
      light_sensor: sensor.motion_e_illuminance
      light_level: 100
      sleep_mode_switch: switch.adaptive_lighting_sleep_mode_hallway_upstairs
